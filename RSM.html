<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remito de Solicitud de Materiales</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; }
        .section { margin: 20px 0; }
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        label { display: block; margin: 10px 0 5px; }
        input, textarea, select { width: 100%; padding: 8px; margin-bottom: 10px; }
        button { padding: 10px 20px; background-color: #007bff; color: white; border: none; cursor: pointer; margin-right: 10px; }
        button:hover { background-color: #0056b3; }
        .add-row { margin-top: 10px; }
    </style>
</head>
<body>
    <div id="remito-content">
        <div class="header">
            <h1>Remito de Solicitud de Materiales</h1>
            <p>Número de Remito: <input type="text" id="numero-remito" placeholder="Ej: REM-001"></p>
            <p>Fecha: <input type="date" id="fecha"></p>
            <p>Cliente: <input type="text" id="cliente" placeholder="Ej: Vitco S.R.L"></p>
            <p>Obra/Servicio: <input type="text" id="obra" placeholder="Ej: Instalación Aire Acondicionado en Oficina"></p>
            <p>Desarrollado por Persat.io</p>
        </div>

        <div class="section">
            <h2>Lista de Materiales Solicitados</h2>
            <table id="materiales-table">
                <thead>
                    <tr>
                        <th>Descripción</th>
                        <th>Unidad de Medida (UM)</th>
                        <th>Cantidad</th>
                        <th>Acción</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><input type="text" placeholder="Ej: Compresor"></td>
                        <td><input type="text" placeholder="Ej: Unidad"></td>
                        <td><input type="number" placeholder="1"></td>
                        <td><button onclick="eliminarFila(this)">Eliminar</button></td>
                    </tr>
                    <tr>
                        <td><input type="text" placeholder="Ej: Capacitor"></td>
                        <td><input type="text" placeholder="Ej: Unidad"></td>
                        <td><input type="number" placeholder="1"></td>
                        <td><button onclick="eliminarFila(this)">Eliminar</button></td>
                    </tr>
                    <!-- Filas adicionales se agregan dinámicamente -->
                </tbody>
            </table>
            <button class="add-row" onclick="agregarFila()">Agregar Material</button>
        </div>

        <div class="section">
            <h2>Observaciones</h2>
            <textarea id="observaciones" rows="4" placeholder="Detalles adicionales sobre la solicitud, urgencia, etc."></textarea>
        </div>

        <div class="section">
            <h2>Información del Técnico</h2>
            <label for="tecnico">Nombre del Técnico:</label>
            <input type="text" id="tecnico" placeholder="Ej: David Andino">

            <label for="telefono-tecnico">Teléfono del Técnico:</label>
            <input type="tel" id="telefono-tecnico" placeholder="Ej: +549123456789">

            <label for="firma-tecnico">Firma del Técnico:</label>
            <input type="text" id="firma-tecnico" placeholder="Nombre o firma digital">
        </div>
    </div>

    <div class="section">
        <button onclick="guardarRemito()">Guardar Remito</button>
        <button onclick="enviarWhatsApp()">Enviar por WhatsApp</button>
        <button onclick="imprimirRemito()">Imprimir Remito</button>
    </div>

    <script>
        function agregarFila() {
            const table = document.getElementById('materiales-table').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.innerHTML = `
                <td><input type="text" placeholder="Descripción"></td>
                <td><input type="text" placeholder="UM"></td>
                <td><input type="number" placeholder="Cantidad"></td>
                <td><button onclick="eliminarFila(this)">Eliminar</button></td>
            `;
        }

        function eliminarFila(button) {
            const row = button.parentNode.parentNode;
            row.parentNode.removeChild(row);
        }

        function guardarRemito() {
            alert('Remito guardado localmente.');
            const data = {
                numeroRemito: document.getElementById('numero-remito').value,
                fecha: document.getElementById('fecha').value,
                cliente: document.getElementById('cliente').value,
                obra: document.getElementById('obra').value,
                observaciones: document.getElementById('observaciones').value,
                tecnico: document.getElementById('tecnico').value,
                telefonoTecnico: document.getElementById('telefono-tecnico').value,
                firmaTecnico: document.getElementById('firma-tecnico').value
            };
            localStorage.setItem('remitoMateriales', JSON.stringify(data));
        }

        function enviarWhatsApp() {
            const numeroRemito = document.getElementById('numero-remito').value;
            const fecha = document.getElementById('fecha').value;
            const cliente = document.getElementById('cliente').value;
            const obra = document.getElementById('obra').value;
            const observaciones = document.getElementById('observaciones').value;
            const tecnico = document.getElementById('tecnico').value;
            const telefonoTecnico = document.getElementById('telefono-tecnico').value;
            const firmaTecnico = document.getElementById('firma-tecnico').value;

            // Recopilar materiales
            const table = document.getElementById('materiales-table');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            let materiales = '';
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                const desc = cells[0].querySelector('input').value;
                const um = cells[1].querySelector('input').value;
                const cant = cells[2].querySelector('input').value;
                if (desc || um || cant) {
                    materiales += `- ${desc} (${um}): ${cant}\n`;
                }
            }

            // Construir mensaje
            const mensaje = `*Remito de Solicitud de Materiales*\n\n` +
                `Número: ${numeroRemito}\n` +
                `Fecha: ${fecha}\n` +
                `Cliente: ${cliente}\n` +
                `Obra/Servicio: ${obra}\n\n` +
                `*Materiales Solicitados:*\n${materiales}\n` +
                `Observaciones: ${observaciones}\n\n` +
                `Técnico: ${tecnico}\n` +
                `Teléfono: ${telefonoTecnico}\n` +
                `Firma: ${firmaTecnico}`;

            // Codificar mensaje para URL
            const mensajeCodificado = encodeURIComponent(mensaje);

            // Abrir WhatsApp (reemplaza con tu número si es fijo, o deja que el usuario elija)
            const url = `https://wa.me/?text=${mensajeCodificado}`;
            window.open(url, '_blank');
        }

        function imprimirRemito() {
            window.print();
        }
    </script>
</body>
</html>
<!-- Agrega este botón en la sección de botones -->
<button onclick="enviarAGoogleSheets()">Enviar a Google Sheets</button>

<!-- Modifica el script JavaScript -->
<script>
    // ... (mantén las funciones existentes como agregarFila, eliminarFila, guardarRemito, enviarWhatsApp, imprimirRemito)

    function enviarAGoogleSheets() {
        // Recopilar datos del formulario
        const numeroRemito = document.getElementById('numero-remito').value;
        const fecha = document.getElementById('fecha').value;
        const cliente = document.getElementById('cliente').value;
        const obra = document.getElementById('obra').value;
        const observaciones = document.getElementById('observaciones').value;
        const tecnico = document.getElementById('tecnico').value;
        const telefonoTecnico = document.getElementById('telefono-tecnico').value;
        const firmaTecnico = document.getElementById('firma-tecnico').value;

        // Recopilar materiales como array de objetos
        const table = document.getElementById('materiales-table');
        const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
        const materiales = [];
        for (let i = 0; i < rows.length; i++) {
            const cells = rows[i].getElementsByTagName('td');
            const desc = cells[0].querySelector('input').value;
            const um = cells[1].querySelector('input').value;
            const cant = cells[2].querySelector('input').value;
            if (desc || um || cant) {
                materiales.push({ descripcion: desc, um: um, cantidad: cant });
            }
        }

        // Datos a enviar
        const data = {
            numeroRemito: numeroRemito,
            fecha: fecha,
            cliente: cliente,
            obra: obra,
            materiales: materiales,
            observaciones: observaciones,
            tecnico: tecnico,
            telefonoTecnico: telefonoTecnico,
            firmaTecnico: firmaTecnico
        };

        // Reemplaza con tu URL de Google Apps Script
        const scriptURL = 'https://script.google.com/macros/s/AKfycby3TLJvSt7feX4-vQFd-6VinL9AOcz_IHCVW32SKmWXhHNPn4JMCgovPWs5S_XCjeMfFQ/exec';

        fetch(scriptURL, {
            method: 'POST',
            body: JSON.stringify(data),
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                alert('Remito enviado a Google Sheets exitosamente.');
            } else {
                alert('Error al enviar: ' + result.error);
            }
        })
        .catch(error => {
            alert('Error de conexión: ' + error);
        });
    }
</script>