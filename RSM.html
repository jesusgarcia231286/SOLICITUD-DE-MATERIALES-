<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Plantilla Pedido de Materiales</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h3 { text-align: center; }
    label { font-weight: bold; display: block; margin-top: 10px; }
    input, textarea { width: 100%; padding: 6px; margin-top: 4px; box-sizing: border-box; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    button { margin-top: 15px; padding: 10px 15px; cursor: pointer; }
    .btn-danger { background-color: #c0392b; color: white; }
    .btn-add { background-color: #2980b9; color: white; }
  </style>
</head>
<body>
  <h3>Solicitud de Materiales</h3>

  <form id="pedidoForm">

    <label for="numeroRemito">Número de Remito:</label>
    <input id="numeroRemito" type="text" required />

    <label for="fecha">Fecha:</label>
    <input id="fecha" type="date" required />

    <label for="cliente">Cliente:</label>
    <input id="cliente" type="text" required />

    <label for="obra">Obra/Servicio:</label>
    <input id="obra" type="text" required />

    <fieldset style="margin-top:15px;">
      <legend><strong>Materiales</strong></legend>
      <table id="tablaMateriales">
        <thead>
          <tr>
            <th>Descripción</th>
            <th>Unidad de Medida</th>
            <th>Cantidad</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input type="text" class="desc" required /></td>
            <td><input type="text" class="um" required /></td>
            <td><input type="number" class="cantidad" min="1" value="1" required /></td>
            <td><button type="button" class="btn-danger" onclick="eliminarFila(this)">Eliminar</button></td>
          </tr>
        </tbody>
      </table>
      <button type="button" class="btn-add" onclick="agregarFila()">Agregar Material</button>
    </fieldset>

    <label for="observaciones">Observaciones:</label>
    <textarea id="observaciones" rows="3"></textarea>

    <label for="tecnico">Técnico:</label>
    <input id="tecnico" type="text" required />

    <label for="telefonoTecnico">Teléfono Técnico:</label>
    <input id="telefonoTecnico" type="text" />

    <button type="submit" style="margin-top:20px;">Enviar Pedido</button>
  </form>

  <script>
    // Función para agregar una fila de materiales nueva
    function agregarFila() {
      const tbody = document.querySelector('#tablaMateriales tbody');
      const nuevaFila = document.createElement('tr');
      nuevaFila.innerHTML = `
        <td><input type="text" class="desc" required></td>
        <td><input type="text" class="um" required></td>
        <td><input type="number" class="cantidad" min="1" value="1" required></td>
        <td><button type="button" class="btn-danger" onclick="eliminarFila(this)">Eliminar</button></td>
      `;
      tbody.appendChild(nuevaFila);
    }

    // Función para eliminar fila de materiales
    function eliminarFila(boton) {
      const fila = boton.closest('tr');
      fila.remove();
    }

    // Eventos formulario
    document.getElementById('pedidoForm').addEventListener('submit', function(e){
      e.preventDefault();

      // Validar y recopilar datos
      const numeroRemito = this.numeroRemito.value.trim();
      const fecha = this.fecha.value;
      const cliente = this.cliente.value.trim();
      const obra = this.obra.value.trim();
      const observaciones = this.observaciones.value.trim();
      const tecnico = this.tecnico.value.trim();
      const telefonoTecnico = this.telefonoTecnico.value.trim();

      const materiales = [];
      const rows = document.querySelectorAll('#tablaMateriales tbody tr');
      for(let row of rows) {
        const desc = row.querySelector('.desc').value.trim();
        const um = row.querySelector('.um').value.trim();
        const cantidad = row.querySelector('.cantidad').value;

        if(desc && um && cantidad > 0) {
          materiales.push({descripcion: desc, um, cantidad});
        }
      }

      if(materiales.length === 0) {
        alert('Debe ingresar al menos un material.');
        return;
      }

      // Aquí puedes procesar los datos: por ejemplo enviarlos a Google Sheets o API
      // Por ahora sólo muestro los datos en consola:
      console.log({
        numeroRemito, fecha, cliente, obra,
        observaciones, tecnico, telefonoTecnico,
        materiales
      });

      alert('Pedido recopilado exitosamente. Implementa la acción que prefieras para enviar o guardar.');
      
      // Si quieres limpiar el formulario:
      // this.reset();
      // document.querySelector('#tablaMateriales tbody').innerHTML = '';
      // agregarFila();
    });
  </script>
</body>
</html>
